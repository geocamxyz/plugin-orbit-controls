(function(m,v){typeof exports=="object"&&typeof module<"u"?v(exports):typeof define=="function"&&define.amd?define(["exports"],v):(m=typeof globalThis<"u"?globalThis:m||self,v(m.OrbitControls={}))})(this,function(m){"use strict";const v=function(q={}){let n,w,g,E,p,z=!1,c=!1,L=0,P=0,h=0,s=!0,Y=0,D=0,x=0,O=0,i=0;const a=[130,100,75,50,35,25,15,10],H=300,X=50,Z=function(e){s=e};this.setEnabled=Z;const b=function(e){if(typeof e!="number"||e<10||e>130)return console.warn("Invalid FOV value:",e,"defaulting to zoom level 0"),0;let t=0,o=Math.abs(a[0]-e);for(let r=1;r<a.length;r++){const l=Math.abs(a[r]-e);l<o&&(o=l,t=r)}return t},j=function(e,t){const o=Date.now(),r=o-D,l=Math.abs(e-x),f=Math.abs(t-O);if(r<H&&l<X&&f<X){if(!n||typeof n.fov!="function")return console.warn("Invalid viewer state, skipping double-tap"),D=0,!0;try{const u=n.fov();i=b(u),i=(i+1)%a.length;const d=a[i];if(d<10||d>130)return console.warn("Invalid zoom target:",d,"resetting to safe value"),i=0,n.fov(a[0]),D=0,!0;n.fov(d),console.log(`Zoom level: ${i}/${a.length-1}, FOV: ${d}`)}catch(u){console.warn("Double-tap zoom error:",u);try{i=0,n.fov(a[0])}catch(d){console.error("Critical zoom error:",d)}}return D=0,!0}else return D=o,x=e,O=t,!1},M=function(e){if(!s)return;let t=n.fov();e.wheelDeltaY?t-=e.wheelDeltaY*.05:e.wheelDelta?t-=e.wheelDelta*.05:e.detail&&(t+=e.detail*1),(t<10||t>130)&&(t=t<10?10:130),n.fov(t),i=b(t)},y=function(e){s&&(z=!1)},C=function(e){if(s&&z){n.facing();const t=n.fov(),o=n.wrapper.clientHeight,r=t/o;let l=(e.clientX-w)*-r+E,f=(e.clientY-g)*-r+p;f=Math.max(-85,Math.min(85,f)),n.facing((360+l)%360),n.horizon(f)}},V=function(e){s&&(e.preventDefault(),w=e.clientX,g=e.clientY,E=n.facing(),p=Math.max(-85,Math.min(85,n.horizon())),z=!0)},S=function(e,t){const o=e.clientX-t.clientX,r=e.clientY-t.clientY;return Math.sqrt(o*o+r*r)},F=function(e){if(s)if(e.preventDefault(),e.touches.length===1){const t=e.touches[0];w=t.clientX,g=t.clientY,E=n.facing(),p=Math.max(-85,Math.min(85,n.horizon())),c=!0}else e.touches.length===2&&(c=!1,h=S(e.touches[0],e.touches[1]),Y=n.fov())},I=function(e){if(s){if(e.preventDefault(),e.touches.length===1&&c){const t=e.touches[0],o=n.fov(),r=n.wrapper.clientHeight,l=o/r;let f=(t.clientX-w)*-l+E,u=(t.clientY-g)*-l+p;u=Math.max(-85,Math.min(85,u)),n.facing((360+f)%360),n.horizon(u)}else if(e.touches.length===2){const t=S(e.touches[0],e.touches[1]),o=h/t;let r=Y*o;r=Math.max(10,Math.min(130,r)),n.fov(r),i=b(r)}}},T=function(e){if(s){if(e.touches.length===0&&c){const t=e.changedTouches[0],o=j(t.clientX,t.clientY);c=!1,h=0}else if(e.touches.length===0)c=!1,h=0;else if(e.touches.length===1){const t=e.touches[0];w=t.clientX,g=t.clientY,E=n.facing(),p=Math.max(-85,Math.min(85,n.horizon())),c=!0,h=0}}},$=function(){if(L){const t=performance.now()-P;let o=n.facing();o=o+50/1e3*t*L,n.facing((360+o)%360),P+=t,requestAnimationFrame($)}},A=function(e){if(!s||e.target.closest("input,calcite-input"))return;const t=e.key==="ArrowLeft"||e.key==="a",o=e.key==="ArrowRight"||e.key==="d";(t||o)&&(P=performance.now(),L=o?1:-1,requestAnimationFrame($))},G=function(e){s&&(L=0)};this.init=function(e){n=e,setTimeout(()=>{try{if(n&&typeof n.fov=="function"){const t=n.fov();i=b(t),console.log(`Initialized zoom level: ${i}, Initial FOV: ${t}`)}else console.warn("Viewer not ready during initialization, using default zoom level"),i=0}catch(t){console.warn("Error during zoom initialization:",t),i=0}},100),n.renderer.domElement.addEventListener("mousewheel",M,!1),n.renderer.domElement.addEventListener("DOMMouseScroll",M,!1),n.renderer.domElement.addEventListener("mousedown",V,!1),n.renderer.domElement.addEventListener("mouseup",y,!1),n.renderer.domElement.addEventListener("mouseleave",y,!1),n.renderer.domElement.addEventListener("mousemove",C,!1),n.renderer.domElement.addEventListener("touchstart",F,{passive:!1}),n.renderer.domElement.addEventListener("touchmove",I,{passive:!1}),n.renderer.domElement.addEventListener("touchend",T,{passive:!1}),n.renderer.domElement.addEventListener("touchcancel",T,{passive:!1}),window.addEventListener("keydown",A),window.addEventListener("keyup",G)},this.destroy=function(){n.renderer.domElement.removeEventListener("mousewheel",M,!1),n.renderer.domElement.removeEventListener("DOMMouseScroll",M,!1),n.renderer.domElement.removeEventListener("mousedown",V,!1),n.renderer.domElement.removeEventListener("mouseup",y,!1),n.renderer.domElement.removeEventListener("mouseleave",y,!1),n.renderer.domElement.removeEventListener("mousemove",C,!1),n.renderer.domElement.removeEventListener("touchstart",F,!1),n.renderer.domElement.removeEventListener("touchmove",I,!1),n.renderer.domElement.removeEventListener("touchend",T,!1),n.renderer.domElement.removeEventListener("touchcancel",T,!1),window.removeEventListener("keydown",A),window.removeEventListener("keyup",G)}};class k extends HTMLElement{constructor(){super(),this.controls=null,console.log("orbit-controls init")}connectedCallback(){console.log("orbit-controls connected"),this.plugin=new v;const n=this.parentNode;this.viewer=n.viewer,this.viewer&&this.viewer.plugin?this.viewer.plugin(this.plugin):console.error("GeocamViewerOrbitControls must be a child of GeocamViewer")}disconnectedCallback(){this.controls=null,this.viewer=null,console.log("orbit controls disconnected")}}window.customElements.define("geocam-viewer-orbit-controls",k),m.GeocamViewerOrbitControls=k,Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})});
