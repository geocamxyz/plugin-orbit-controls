(function(v,p){typeof exports=="object"&&typeof module<"u"?p(exports):typeof define=="function"&&define.amd?define(["exports"],p):(v=typeof globalThis<"u"?globalThis:v||self,p(v.OrbitControls={}))})(this,(function(v){"use strict";const p=function(q={}){let t,a,l,w,E,z=!1,u=!1,L=0,P=0,g=0,s=!0,Y=0,D=0,x=0,O=0,r=0;const f=[130,100,75,50,35,25,15,10],H=300,X=50,Z=function(e){s=e};this.setEnabled=Z;const b=function(e){if(typeof e!="number"||e<10||e>130)return console.warn("Invalid FOV value:",e,"defaulting to zoom level 0"),0;let n=0,o=Math.abs(f[0]-e);for(let i=1;i<f.length;i++){const c=Math.abs(f[i]-e);c<o&&(o=c,n=i)}return n},j=function(e,n){const o=Date.now(),i=o-D,c=Math.abs(e-x),d=Math.abs(n-O);if(i<H&&c<X&&d<X){if(!t||typeof t.fov!="function")return console.warn("Invalid viewer state, skipping double-tap"),D=0,!0;try{const m=t.fov();r=b(m),r=(r+1)%f.length;const h=f[r];if(h<10||h>130)return console.warn("Invalid zoom target:",h,"resetting to safe value"),r=0,t.fov(f[0]),D=0,!0;t.fov(h),console.log(`Zoom level: ${r}/${f.length-1}, FOV: ${h}`)}catch(m){console.warn("Double-tap zoom error:",m);try{r=0,t.fov(f[0])}catch(h){console.error("Critical zoom error:",h)}}return D=0,!0}else return D=o,x=e,O=n,!1},y=function(e){if(!s)return;let n=t.fov();e.wheelDeltaY?n-=e.wheelDeltaY*.05:e.wheelDelta?n-=e.wheelDelta*.05:e.detail&&(n+=e.detail*1),(n<10||n>130)&&(n=n<10?10:130),t.fov(n),r=b(n)},M=function(e){s&&(z=!1)},C=function(e){if(s&&z){t.facing();const n=t.fov(),o=t.wrapper.clientHeight,i=n/o;let c=(e.clientX-a)*-i+w,d=(e.clientY-l)*-i+E;d=Math.max(-85,Math.min(85,d)),t.facing((360+c)%360),t.horizon(d)}},V=function(e){s&&(e.preventDefault(),a=e.clientX,l=e.clientY,w=t.facing(),E=Math.max(-85,Math.min(85,t.horizon())),z=!0)},S=function(e,n){const o=e.clientX-n.clientX,i=e.clientY-n.clientY;return Math.sqrt(o*o+i*i)},F=function(e){if(s)if(e.preventDefault(),e.touches.length===1){const n=e.touches[0];a=n.clientX,l=n.clientY,w=t.facing(),E=Math.max(-85,Math.min(85,t.horizon())),u=!0}else e.touches.length===2&&(u=!1,g=S(e.touches[0],e.touches[1]),Y=t.fov())},I=function(e){if(s){if(e.preventDefault(),e.touches.length===1&&u){const n=e.touches[0],o=t.fov(),i=t.wrapper.clientHeight,c=o/i;let d=(n.clientX-a)*-c+w,m=(n.clientY-l)*-c+E;m=Math.max(-85,Math.min(85,m)),t.facing((360+d)%360),t.horizon(m)}else if(e.touches.length===2){const n=S(e.touches[0],e.touches[1]),o=g/n;let i=Y*o;i=Math.max(10,Math.min(130,i)),t.fov(i),r=b(i)}}},T=function(e){if(s){if(e.touches.length===0&&u){const n=e.changedTouches[0],o=j(n.clientX,n.clientY);u=!1,g=0}else if(e.touches.length===0)u=!1,g=0;else if(e.touches.length===1){const n=e.touches[0];a=n.clientX,l=n.clientY,w=t.facing(),E=Math.max(-85,Math.min(85,t.horizon())),u=!0,g=0}}},$=function(){if(L){const n=performance.now()-P;let o=t.facing();o=o+50/1e3*n*L,t.facing((360+o)%360),P+=n,requestAnimationFrame($)}},A=function(e){if(!s||e.target.closest("input,calcite-input"))return;const n=e.key==="ArrowLeft"||e.key==="a",o=e.key==="ArrowRight"||e.key==="d";(n||o)&&(P=performance.now(),L=o?1:-1,requestAnimationFrame($))},G=function(e){s&&(L=0)};this.init=function(e){t=e,setTimeout(()=>{try{if(t&&typeof t.fov=="function"){const n=t.fov();r=b(n),console.log(`Initialized zoom level: ${r}, Initial FOV: ${n}`)}else console.warn("Viewer not ready during initialization, using default zoom level"),r=0}catch(n){console.warn("Error during zoom initialization:",n),r=0}},100),t.renderer.domElement.addEventListener("mousewheel",y,!1),t.renderer.domElement.addEventListener("DOMMouseScroll",y,!1),t.renderer.domElement.addEventListener("mousedown",V,!1),t.renderer.domElement.addEventListener("mouseup",M,!1),t.renderer.domElement.addEventListener("mouseleave",M,!1),t.renderer.domElement.addEventListener("mousemove",C,!1),t.renderer.domElement.addEventListener("touchstart",F,{passive:!1}),t.renderer.domElement.addEventListener("touchmove",I,{passive:!1}),t.renderer.domElement.addEventListener("touchend",T,{passive:!1}),t.renderer.domElement.addEventListener("touchcancel",T,{passive:!1}),window.addEventListener("keydown",A),window.addEventListener("keyup",G)},this.destroy=function(){t.renderer.domElement.removeEventListener("mousewheel",y,!1),t.renderer.domElement.removeEventListener("DOMMouseScroll",y,!1),t.renderer.domElement.removeEventListener("mousedown",V,!1),t.renderer.domElement.removeEventListener("mouseup",M,!1),t.renderer.domElement.removeEventListener("mouseleave",M,!1),t.renderer.domElement.removeEventListener("mousemove",C,!1),t.renderer.domElement.removeEventListener("touchstart",F,!1),t.renderer.domElement.removeEventListener("touchmove",I,!1),t.renderer.domElement.removeEventListener("touchend",T,!1),t.renderer.domElement.removeEventListener("touchcancel",T,!1),window.removeEventListener("keydown",A),window.removeEventListener("keyup",G)}};class k extends HTMLElement{constructor(){super(),this.controls=null,this.viewer=null,this.plugin=null,console.log("orbit-controls init")}connectedCallback(){console.log("orbit-controls connected");const t=this.closest("geocam-viewer");if(!t){console.error("GeocamViewerOrbitControls must be a child of GeocamViewer");return}const a=()=>{const l=t.viewer;if(l&&typeof l.plugin=="function"){if(this.plugin)return;this.viewer=l,this.plugin=new p,this.viewer.plugin(this.plugin)}else setTimeout(a,50)};a()}disconnectedCallback(){this.plugin&&typeof this.plugin.destroy=="function"&&this.plugin.destroy(),this.plugin=null,this.viewer=null,console.log("orbit controls disconnected")}}window.customElements.define("geocam-viewer-orbit-controls",k),v.GeocamViewerOrbitControls=k,Object.defineProperty(v,Symbol.toStringTag,{value:"Module"})}));
